---
// ==================================================
// ğŸ”´ æœåŠ¡ç«¯ä»£ç åŒºåŸŸ (Frontmatter)
// ==================================================

import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import PostCard from "../components/PostCard.astro";

// 1. è·å–æ–‡ç« 
const allPosts = await getCollection("blog");

// 2. å¤„ç†æ’åº (åŠ å…¥é˜²å´©é€»è¾‘)
const posts = allPosts
  .filter((post) => !post.data.draft) // è¿‡æ»¤è‰ç¨¿
  .sort((a, b) => {
    // å®‰å…¨è·å–æ—¶é—´æˆ³
    const dateA = a.data.date ? new Date(a.data.date).valueOf() : 0;
    const dateB = b.data.date ? new Date(b.data.date).valueOf() : 0;
    return dateB - dateA; // é™åºï¼šæ–°çš„åœ¨å‰
  });
---

<Layout
  title="Home"
  description="è¿™é‡Œæ˜¯ä¸€åªçŒ«çŒ«çš„è‡ªç•™åœ°"
  image="/images/cover.jpg"
>
  <section class="hero-card">
    <div class="hero-content">
      <h1 class="hero-title display-medium">æ¬¢è¿åˆ°è®¿ Vahiru's blog</h1>
      <p class="hero-desc">è¿™é‡Œæ˜¯ä¸€åªçŒ«çŒ«çš„è‡ªç•™åœ°</p>

      <md-elevated-button href="/about" class="hero-button">
        About Me
        <md-icon slot="icon">arrow_forward</md-icon>
      </md-elevated-button>
    </div>
  </section>

  <h2 class="section-title">Recent Posts</h2>

  <div class="post-grid">
    {posts.slice(0, 6).map((post) => <PostCard post={post} />)}

    {
      posts.length === 0 && (
        <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; opacity: 0.6;">
          è¿˜æ²¡æœ‰æ–‡ç« ï¼Œè¯·åœ¨ src/content/blog/ ä¸‹åˆ›å»º .md æ–‡ä»¶
        </div>
      )
    }
  </div>

  {
    posts.length > 6 && (
      <div style="text-align: center; margin-top: 2rem;">
        <md-filled-tonal-button href="/archives/1">
          View All Posts
          <md-icon slot="icon">arrow_forward</md-icon>
        </md-filled-tonal-button>
      </div>
    )
  }
</Layout>

<style>
  /* === HERO æ ·å¼ === */
  .hero-card {
    background-image: radial-gradient(
      circle at 50% 10%,
      var(--md-sys-color-surface-container-high) 1%,
      var(--md-sys-color-primary-container) 70%
    );
    background-color: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
    border-radius: 28px;
    padding: 4rem 3rem;
    margin-bottom: 3rem;
    position: relative;
    overflow: hidden;
    display: block;
  }

  .hero-content {
    max-width: 800px;
  }

  .hero-title {
    font-size: 3rem;
    margin: 0 0 1rem 0;
    font-weight: 500;
    line-height: 1.2;
  }

  .hero-desc {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    opacity: 0.9;
  }

  .hero-button {
    --md-elevated-button-container-color: var(--md-sys-color-primary);
    --md-elevated-button-label-text-color: var(--md-sys-color-on-primary);
    --md-icon-color: var(--md-sys-color-on-primary);
  }

  /* === åˆ—è¡¨æ ·å¼ === */
  .section-title {
    margin: 2rem 0 1.5rem 0.5rem;
    font-size: 1.75rem;
    font-weight: 500;
    color: var(--md-sys-color-on-surface);
  }

  .post-grid {
    display: grid;
    gap: 24px;
    /* æ¡Œé¢ç«¯ï¼šè‡ªé€‚åº”åˆ—å®½ */
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }

  /* ç§»åŠ¨ç«¯é€‚é… */
  @media (max-width: 992px) {
    .post-grid {
      grid-template-columns: 1fr; /* å¼ºåˆ¶å•åˆ— */
    }
    .hero-card {
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .hero-title {
      font-size: 2rem;
    }
  }
</style>
