---
import NavRail from '../components/NavRail.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

interface Props { title?: string; }
const { title = "My Blog" } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{title}</title>
        <script is:inline>
            const theme = (() => {
                if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) return localStorage.getItem('theme');
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';
                return 'light';
            })();
            if (theme === 'dark') document.documentElement.classList.add('dark');
        </script>
	</head>
	<body>
        <div id="scrim" class="scrim"></div>

		<header class="mobile-top-bar">
            <button id="menu-btn" class="icon-btn" aria-label="Menu"><md-icon>menu</md-icon></button>
            <div class="header-title">{title}</div>
            <button class="icon-btn" aria-label="Search"><md-icon>search</md-icon></button>
		</header>
		
        <div class="app-grid">
			<NavRail />
			<main class="main-content">
				<slot />
                <Footer />
			</main>
		</div>

        <script>
            import '@material/web/icon/icon.js';
            import '@material/web/ripple/ripple.js';
            import '@material/web/button/elevated-button.js';

            const menuBtn = document.getElementById('menu-btn');
            const scrim = document.getElementById('scrim');
            const body = document.body;

            menuBtn?.addEventListener('click', () => body.classList.add('drawer-open'));
            scrim?.addEventListener('click', () => body.classList.remove('drawer-open'));
            document.addEventListener('astro:after-swap', () => body.classList.remove('drawer-open'));
        </script>
	</body>
</html>

<style>
    /* === 桌面端布局 (Desktop Grid) === */
    @media (min-width: 993px) {
        .mobile-top-bar { display: none; }
        .scrim { display: none; }

        /* 强制开启 Grid，左固定，右自适应 */
        .app-grid {
            display: grid;
            grid-template-columns: 88px 1fr; /* 88px给侧栏，剩下给内容 */
            grid-template-rows: 100vh; /* 占满全屏高度 */
            overflow: hidden; /* 禁止外层滚动 */
        }

        .main-content {
            background-color: var(--md-sys-color-surface-container);
            border-top-left-radius: 24px;
            border-bottom-left-radius: 24px;
            height: 100%; /* 跟随 Grid 高度 */
            overflow-y: auto; /* 内部滚动 */
            padding: 2rem 3rem;
            position: relative;
        }
    }

    /* === 移动端布局 (Mobile Flow) === */
    @media (max-width: 992px) {
        .app-grid {
            display: block; /* 回归普通流 */
            height: auto;
        }

        .mobile-top-bar {
            display: flex; position: fixed; top: 0; left: 0; right: 0;
            height: 64px; z-index: 1100; 
            background-color: var(--md-sys-color-surface);
            align-items: center; justify-content: space-between; padding: 0 16px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .main-content {
            margin-top: 64px; /* 避开 Header */
            padding: 1rem;
            min-height: calc(100vh - 64px);
            background-color: var(--md-sys-color-surface);
            border-radius: 0;
        }

        .scrim {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            z-index: 1200; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        body.drawer-open .scrim { opacity: 1; pointer-events: auto; }
        body.drawer-open { overflow: hidden; }
        
        .icon-btn { display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; }
        .header-title { font-size: 1.25rem; font-weight: 500; }
    }
</style>