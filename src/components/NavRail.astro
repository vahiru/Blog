---
import ColorPicker from './ColorPicker.astro'; 
const pathname = Astro.url.pathname;
---

<nav class="nav-rail">
  
  <div class="fab-wrapper">
    <button class="search-fab" aria-label="Search" id="search-btn">
      <md-icon>search</md-icon>
      <md-ripple></md-ripple>
    </button>
  </div>

  <div class="nav-links">
    <a href="/" class={pathname === '/' ? 'active' : ''}>
      <div class="icon-box"><md-icon>home</md-icon><md-ripple></md-ripple></div>
      <span class="label">Home</span>
    </a>

    <a href="/archives" class={pathname.startsWith('/archives') ? 'active' : ''}>
      <div class="icon-box"><md-icon>inventory_2</md-icon><md-ripple></md-ripple></div>
      <span class="label">Blog</span>
    </a>

    <a href="/about" class={pathname.startsWith('/about') ? 'active' : ''}>
      <div class="icon-box"><md-icon>face</md-icon><md-ripple></md-ripple></div>
      <span class="label">About</span>
    </a>
  </div>

  <div class="spacer"></div>

  <button id="palette-btn" class="nav-item-btn">
    <div class="icon-box">
      <md-icon>palette</md-icon>
      <md-ripple></md-ripple>
    </div>
    <span class="label">Color</span>
  </button>

  <button id="theme-toggle" class="nav-item-btn">
    <div class="icon-box">
      <md-icon id="theme-icon">dark_mode</md-icon>
      <md-ripple></md-ripple>
    </div>
    <span class="label">Theme</span>
  </button>

  <ColorPicker />

</nav>

<script>
    // 1. 简单的直接绑定逻辑
    const paletteBtn = document.getElementById('palette-btn');
    const dialog = document.getElementById('theme-dialog');

    // 直接点击 -> 打开弹窗
    if (paletteBtn && dialog) {
        paletteBtn.addEventListener('click', () => {
            // @ts-ignore
            dialog.showModal();
        });
    }

    // 2. 主题切换逻辑
    const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("dark");
        const isDark = element.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        
        const icon = document.getElementById("theme-icon");
        if (icon) icon.innerText = isDark ? "light_mode" : "dark_mode";
    }

    document.getElementById("theme-toggle")?.addEventListener("click", handleToggleClick);

    // 初始化图标
    const isDark = document.documentElement.classList.contains("dark");
    const icon = document.getElementById("theme-icon");
    if (icon) icon.innerText = isDark ? "light_mode" : "dark_mode";
</script>

<style>
  /* 保持样式不变 */
  .nav-rail {
    display: flex; flex-direction: column; align-items: center;
    padding: 12px 0 24px 0; height: 100vh;
    width: 88px; min-width: 88px; box-sizing: border-box;
    grid-column: 1 / 2; background-color: var(--md-sys-color-surface);
    z-index: 10;
  }
  .spacer { flex-grow: 1; }
  .fab-wrapper { margin-bottom: 24px; padding-top: 8px; }
  .search-fab {
    position: relative; width: 56px; height: 56px; border-radius: 16px;
    border: none; cursor: pointer;
    background-color: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s;
  }
  .search-fab:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
  .nav-links { display: flex; flex-direction: column; gap: 12px; width: 100%; align-items: center; }
  a, .nav-item-btn {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    width: 100%; gap: 4px; margin-bottom: 12px; text-decoration: none;
    background: transparent; border: none; cursor: pointer;
    color: var(--md-sys-color-on-surface-variant); padding: 0;
  }
  .icon-box {
    position: relative; width: 56px; height: 32px; border-radius: 16px;
    display: flex; align-items: center; justify-content: center;
    overflow: hidden; transition: background-color 0.2s;
  }
  .label { font-size: 11px; font-weight: 500; font-family: 'Roboto', sans-serif; }
  a.active .icon-box {
    background-color: var(--md-sys-color-secondary-container);
    color: var(--md-sys-color-on-secondary-container);
  }
  a.active .label { font-weight: 700; color: var(--md-sys-color-on-surface); }
  md-icon { font-size: 24px; }
</style>